<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KCAç«¶æ³³ã‚¹ã‚¿ãƒ¼ãƒˆåˆå›³ã‚¿ã‚¤ãƒãƒ¼</title>
    
    <!-- iOS PWA è¨­å®š -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="SWIMMING PRACTICE CLOCK">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            color: #333;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        /* ä¸Šéƒ¨è¡¨ç¤º */
        .top-info {
            display: flex;
            justify-content: space-around;
            margin-bottom: 10px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 10px;
        }
        
        .info-item {
            text-align: center;
        }
        
        .info-label {
            font-size: 11px;
            color: #666;
        }
        
        .info-value {
            font-size: 18px;
            font-weight: bold;
            color: #2b2f8f;
        }
        
        /* æ–‡å­—ç›¤ã‚¨ãƒªã‚¢ */
        .clock-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0;
            margin-bottom: 20px;
        }
        
        /* æ–‡å­—ç›¤ã‚³ãƒ³ãƒ†ãƒŠ */
        .clock-container {
            position: relative;
            width: 360px;
            height: 360px;
            flex-shrink: 0;
        }
        
        .dial-wrap {
            display: inline-block;
            position: relative;
        }
        
        /* é‡ */
        .hands-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 360px;
            height: 360px;
            pointer-events: none;
        }
        
        .hand {
            position: absolute;
            left: 50%;
            bottom: 50%;
            transform-origin: bottom center;

        }
        
        .minute-hand {
            width: 6px;
            height: 100px;
            background: #333;
            margin-left: -3px;
            border-radius: 3px;
        }
        
        .second-hand {
            width: 4px;
            height: 130px;
            background: #ff1744;
            margin-left: -2px;
            border-radius: 2px;
        }
        .counter {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 15px;
            width: 100%;
            max-width: 360px;
        }
        
        .counter-label {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }
        
        .counter-current {
            font-size: 48px;
            font-weight: bold;
            color: #ff1744;
            line-height: 1;
            padding: 8px 60px;
            border: 3px solid #ff1744;
            border-radius: 8px;
            display: inline-block;
            min-width: 200px;
            text-align: center;
        }
        
        .counter-total {
            font-size: 16px;
            color: #999;
            font-weight: 500;
        }
        
        /* ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³æ  */
        .countdown-section {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .countdown-item {
            text-align: center;
        }
        
        .countdown-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 6px;
        }
        
        .countdown-value {
            font-size: 24px;
            font-weight: bold;
            color: #2b2f8f;
            padding: 8px 12px;
            border: 2px solid #2b2f8f;
            border-radius: 8px;
            background: white;
            height: 40px;
            line-height: 24px;
        }
        
        /* ãƒœã‚¿ãƒ³ */
        .button-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .btn {
            padding: 18px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-blue {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .btn-blue:active:not(:disabled) {
            transform: scale(0.95);
        }
        
        .btn-green {
            background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
        }
        
        .btn-red {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        }
        
        .btn-red:active:not(:disabled) {
            transform: scale(0.95);
        }
        
        .btn-gray {
            background: #999;
        }
        
        .btn-gray:active {
            transform: scale(0.95);
        }
        
        .hidden {
            display: none;
        }
        
        /* è¨­å®šãƒ‘ãƒãƒ« */
        .settings {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .settings-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 12px;
            color: #333;
        }
        
        .setting-group {
            margin-bottom: 15px;
        }
        
        .setting-label {
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
            display: block;
        }
        
        .setting-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            outline: none;
        }
        
        input[type="number"],
        select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .minute-value {
            min-width: 50px;
            text-align: center;
            font-weight: bold;
            color: #2b2f8f;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ä¸Šéƒ¨è¡¨ç¤º -->
        <div class="top-info">
            <div class="info-item">
                <div class="info-label">ã‚µã‚¤ã‚¯ãƒ«</div>
                <div class="info-value" id="displayCycle">0:40</div>
            </div>
            <div class="info-item">
                <div class="info-label">çµ„æ•°</div>
                <div class="info-value" id="displaySwimmers">3</div>
            </div>
            <div class="info-item">
                <div class="info-label">é–“éš”</div>
                <div class="info-value" id="displayInterval">5ç§’</div>
            </div>
        </div>
        
        <!-- æ–‡å­—ç›¤ã¨æœ¬æ•° -->
        <div class="clock-section">
            <!-- æ–‡å­—ç›¤ -->
            <div class="clock-container">
                <div class="dial-wrap">
                    <svg id="dial" viewBox="0 0 400 400" width="360" height="360" aria-label="60 seconds dial"></svg>
                    <div class="hands-container">
                        <div class="hand minute-hand" id="minuteHand"></div>
                        <div class="hand second-hand" id="secondHand"></div>
                    </div>
                </div>
            </div>
            
            <!-- æ®‹ã‚Šæœ¬æ•° -->
            <div class="counter">
                <div class="counter-label">æ®‹ã‚Šæœ¬æ•°</div>
                <div class="counter-current" id="currentSet">-</div>
                <div class="counter-total" id="totalSets">/ -</div>
            </div>
        </div>
        
        <!-- ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³æ  -->
        <div class="countdown-section">
            <div class="countdown-item">
                <div class="countdown-label">æ¬¡ã®ã‚¹ã‚¿ãƒ¼ãƒˆã¾ã§</div>
                <div class="countdown-value" id="nextStart">--</div>
            </div>
            <div class="countdown-item">
                <div class="countdown-label">ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹å§‹ã¾ã§</div>
                <div class="countdown-value" id="menuStart">--</div>
            </div>
        </div>
        
        <!-- ãƒœã‚¿ãƒ³ -->
        <div class="button-row">
            <button class="btn btn-blue" id="syncBtn">ç§’é‡ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            <button class="btn btn-red" id="startBtn" disabled>ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹å§‹</button>
        </div>

        
        <!-- ä¿å­˜æ¸ˆã¿ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
        <div id="savedMenusContainer" style="margin: 20px 0; display: none;">
            <div style="font-size: 14px; font-weight: bold; margin-bottom: 10px; color: #333;">ğŸ’¾ ä¿å­˜æ¸ˆã¿ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
            <div id="savedMenusList" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
        </div>
        
        <!-- è¨­å®š -->
        <div class="settings" id="settings">
            <div class="settings-title">âš™ï¸ è¨­å®š</div>
            
            <div class="setting-group">
                <label class="setting-label">åˆ†é‡ä½ç½®ï¼ˆ0-59åˆ†ï¼‰</label>
                <div class="setting-row">
                    <input type="range" id="minuteSlider" min="0" max="59" value="0">
                    <span class="minute-value" id="minuteValue">0</span>
                </div>
            </div>
            
            <div class="setting-group">
                <label class="setting-label">ã‚µãƒ¼ã‚¯ãƒ«</label>
                <div class="setting-row">
                    <input type="number" id="cycleMins" min="0" max="10" value="0" style="width:70px"> åˆ†
                    <select id="cycleSecs" style="width:80px">
                        <option value="0">0</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="15">15</option>
                        <option value="20">20</option>
                        <option value="25">25</option>
                        <option value="30">30</option>
                        <option value="35">35</option>
                        <option value="40" selected>40</option>
                        <option value="45">45</option>
                        <option value="50">50</option>
                        <option value="55">55</option>
                    </select> ç§’
                </div>
            </div>
            
            <div class="setting-group">
                <label class="setting-label">çµ„æ•°ï¼ˆäººæ•°ï¼‰</label>
                <input type="number" id="swimmers" min="1" max="10" value="3" style="width:100%">
            </div>
            
            <div class="setting-group">
                <label class="setting-label">é–“éš”ï¼ˆç§’ï¼‰</label>
                <select id="interval" style="width:100%">
                    <option value="5" selected>5</option>
                    <option value="10">10</option>
                    <option value="15">15</option>
                    <option value="20">20</option>
                    <option value="25">25</option>
                    <option value="30">30</option>
                </select>
            </div>
            
            <div class="setting-group">
                <label class="setting-label">æœ¬æ•°</label>
                <input type="number" id="sets" min="1" max="20" value="5" style="width:100%">
            </div>
            
            <div class="setting-group">
                <label class="setting-label">éŸ³å£°è¨­å®š</label>
                <div style="display:flex; flex-direction:column; gap:8px; margin-top:8px;">
                    <label style="display:flex; align-items:center; gap:8px; font-size:14px;">
                        <input type="checkbox" id="voice10sec" checked style="width:18px; height:18px;">
                        <span>10ç§’å‰ã‚³ãƒ¼ãƒ«</span>
                    </label>
                    <label style="display:flex; align-items:center; gap:8px; font-size:14px;">
                        <input type="checkbox" id="voice5sec" checked style="width:18px; height:18px;">
                        <span>5ç§’å‰ã‚³ãƒ¼ãƒ«</span>
                    </label>
                    <label style="display:flex; align-items:center; gap:8px; font-size:14px;">
                        <input type="checkbox" id="voiceSetNumber" checked style="width:18px; height:18px;">
                        <span>æœ¬æ•°ã‚³ãƒ¼ãƒ«</span>
                    </label>
                </div>
            </div>
            
            <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                <button id="saveMenuBtn" class="btn btn-green" style="width: 100%; padding: 12px; font-size: 14px;">
                    ğŸ’¾ ç¾åœ¨ã®è¨­å®šã‚’ä¿å­˜
                </button>
            </div>

        </div>
    </div>
    
    <script>
        // ========================================
        // æ–‡å­—ç›¤SVGæç”»ï¼ˆã‚ˆã—ã²ã“ã•ã‚“æä¾›ã‚³ãƒ¼ãƒ‰ãƒ»å››è§’æ ã‚ã‚Šãƒ»ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º16ï¼‰
        // ========================================
        (() => {
            const svg = document.getElementById("dial");
            const NS = "http://www.w3.org/2000/svg";

            const W = 400, H = 400;
            const cx = 200, cy = 200;

            // theme
            const borderColor = "#2b2f8f";
            const blue = "#2b2f8f";
            const red  = "#d02626";
            const bg   = "#ffffff";

            // background rounded rectï¼ˆå››è§’æ ã‚ã‚Šï¼‰
//             const rect = document.createElementNS(NS, "rect");
//             rect.setAttribute("x", "18");
//             rect.setAttribute("y", "18");
//             rect.setAttribute("width", "364");
//             rect.setAttribute("height", "364");
//             rect.setAttribute("rx", "24");
//             rect.setAttribute("fill", bg);
//             rect.setAttribute("stroke", borderColor);
//             rect.setAttribute("stroke-width", "10");
//             svg.appendChild(rect);

            // ticks group
            const gTicks = document.createElementNS(NS, "g");
            svg.appendChild(gTicks);

            // circle radii
            const rOuter = 150;
            const rInnerMinor = 138;
            const rInnerMajor = 126;

            // 60 ticks (0..59)
            for (let i = 0; i < 60; i++) {
                const isMajor = (i % 5 === 0);
                const a = (-90 + i * 6) * Math.PI / 180;

                const x1 = cx + Math.cos(a) * rOuter;
                const y1 = cy + Math.sin(a) * rOuter;
                const x2 = cx + Math.cos(a) * (isMajor ? rInnerMajor : rInnerMinor);
                const y2 = cy + Math.sin(a) * (isMajor ? rInnerMajor : rInnerMinor);

                const line = document.createElementNS(NS, "line");
                line.setAttribute("x1", x1);
                line.setAttribute("y1", y1);
                line.setAttribute("x2", x2);
                line.setAttribute("y2", y2);
                line.setAttribute("stroke", blue);
                line.setAttribute("stroke-linecap", "round");
                line.setAttribute("stroke-width", isMajor ? "6" : "3");
                gTicks.appendChild(line);
            }

            // numbers (5,10,...,60) - ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º16ã«è¨­å®š
            const gNums = document.createElementNS(NS, "g");
            svg.appendChild(gNums);

            const rNum = 105;
            const labels = [60,5,10,15,20,25,30,35,40,45,50,55];

            labels.forEach((v) => {
                const sec = (v === 60) ? 0 : v;
                const a = (-90 + sec * 6) * Math.PI / 180;

                const tx = cx + Math.cos(a) * rNum;
                const ty = cy + Math.sin(a) * rNum;

                const t = document.createElementNS(NS, "text");
                t.setAttribute("x", tx);
                t.setAttribute("y", ty);
                t.setAttribute("text-anchor", "middle");
                t.setAttribute("dominant-baseline", "central");
                t.setAttribute("font-size", "18");
                t.setAttribute("font-weight", "800");
                t.setAttribute("font-family", "system-ui, -apple-system, Segoe UI, Roboto, sans-serif");

                const isRed = (v % 10 !== 0);
                t.setAttribute("fill", isRed ? red : blue);
                t.textContent = String(v);

                gNums.appendChild(t);
            });

            // center dot
            const dot = document.createElementNS(NS, "circle");
            dot.setAttribute("cx", cx);
            dot.setAttribute("cy", cy);
            dot.setAttribute("r", "9");
            dot.setAttribute("fill", "#111");
            svg.appendChild(dot);
        })();
        
        // ========================================
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«AudioContextï¼ˆiOS Safariç”¨ï¼‰
        // ========================================
        let globalAudioContext = null;
        
        // ========================================
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹
        // ========================================
        const state = {
            clockRunning: false,
            clockStartMs: 0,
            tickRunning: false,
            menuRunning: false,
            menuWaiting: false,
            menuStartElapsed: 0,
            events: [],
            minutePosition: 0,
            cycleTime: 0,
            timerIds: []  // ã‚¿ã‚¤ãƒãƒ¼IDç®¡ç†
        };
        
        // ========================================
        // è¦ç´ å‚ç…§
        // ========================================
        const elements = {};
        
        // ========================================
        // åˆæœŸåŒ–
        // ========================================
        function initialize() {
            console.log('ğŸš€ ã‚¢ãƒ—ãƒªåˆæœŸåŒ–é–‹å§‹');
            
            // è¦ç´ å–å¾—
            elements.secondHand = document.getElementById('secondHand');
            elements.minuteHand = document.getElementById('minuteHand');
            elements.nextStart = document.getElementById('nextStart');
            elements.menuStart = document.getElementById('menuStart');
            elements.currentSet = document.getElementById('currentSet');
            elements.totalSets = document.getElementById('totalSets');
            elements.displayCycle = document.getElementById('displayCycle');
            elements.displaySwimmers = document.getElementById('displaySwimmers');
            elements.displayInterval = document.getElementById('displayInterval');
            elements.syncBtn = document.getElementById('syncBtn');
            elements.startBtn = document.getElementById('startBtn');
            elements.settings = document.getElementById('settings');
            elements.minuteSlider = document.getElementById('minuteSlider');
            elements.minuteValue = document.getElementById('minuteValue');
            elements.cycleMins = document.getElementById('cycleMins');
            elements.cycleSecs = document.getElementById('cycleSecs');
            elements.swimmers = document.getElementById('swimmers');
            elements.interval = document.getElementById('interval');
            elements.sets = document.getElementById('sets');
            elements.voice10sec = document.getElementById('voice10sec');
            elements.voice5sec = document.getElementById('voice5sec');
            elements.voiceSetNumber = document.getElementById('voiceSetNumber');
            
            // è¦ç´ å–å¾—ç¢ºèª
            console.log('ğŸ” è¦ç´ å–å¾—ç¢ºèª:');
            console.log('  - startBtn:', elements.startBtn);
            console.log('  - syncBtn:', elements.syncBtn);
            
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            elements.minuteSlider.addEventListener('input', (e) => {
                const minuteValue = parseInt(e.target.value);
                state.minutePosition = minuteValue; // state ã«åæ˜ 
                elements.minuteValue.textContent = minuteValue;
                // åˆ†é‡ã‚’å³åº§ã«æ›´æ–°ï¼ˆã„ã¤ã§ã‚‚åæ˜ ï¼‰
                const minuteDegrees = minuteValue * 6;
                elements.minuteHand.style.transform = `rotate(${minuteDegrees}deg)`;
                console.log('ğŸ”µ åˆ†é‡ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å¤‰æ›´:', minuteValue, 'åº¦:', minuteDegrees);
            });
            elements.cycleMins.addEventListener('change', updateDisplay);
            elements.cycleSecs.addEventListener('change', updateDisplay);
            elements.swimmers.addEventListener('change', updateDisplay);
            elements.interval.addEventListener('change', updateDisplay);
            elements.sets.addEventListener('change', updateDisplay);
            
            elements.syncBtn.addEventListener('click', () => {
                console.log('ğŸ”µ ç§’é‡ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯');
                syncClock();
            });
            elements.startBtn.addEventListener('click', () => {
                console.log('ğŸŸ  ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ - menuRunning:', state.menuRunning, 'menuWaiting:', state.menuWaiting);
                if (!state.menuRunning && !state.menuWaiting) {
                    console.log('ğŸ”´ ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹å§‹ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯');
                    startMenu();
                } else {
                    console.log('â›” ãƒ¡ãƒ‹ãƒ¥ãƒ¼åœæ­¢ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯');
                    stopMenu();
                }
            });
            
            document.getElementById('saveMenuBtn').addEventListener('click', saveMenu);
            
            updateDisplay();
            loadSavedMenus();
            
            console.log('âœ… åˆæœŸåŒ–å®Œäº†');
        }
        
        // ========================================
        // è¡¨ç¤ºæ›´æ–°
        // ========================================
        function updateDisplay() {
            const mins = parseInt(elements.cycleMins.value);
            const secs = parseInt(elements.cycleSecs.value);
            elements.displayCycle.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
            elements.displaySwimmers.textContent = elements.swimmers.value;
            elements.displayInterval.textContent = elements.interval.value + 'ç§’';
            
            // æ®‹ã‚Šæœ¬æ•°ã®ç·æœ¬æ•°ã‚’æ›´æ–°
            const totalSets = parseInt(elements.sets.value);
            elements.totalSets.textContent = totalSets;
        }
        
        // ========================================
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—
        // ========================================
        function tick() {
            if (!state.clockRunning) return;
            
            const totalSeconds = (Date.now() - state.clockStartMs) / 1000;
            
            // ç§’é‡
            const seconds = totalSeconds % 60;
            const secondDegrees = seconds * 6;
            elements.secondHand.style.transform = `rotate(${secondDegrees}deg)`;
            
            // åˆ†é‡
            const totalMinutes = state.minutePosition + (totalSeconds / 60);
            const minuteDegrees = (totalMinutes % 60) * 6;
            elements.minuteHand.style.transform = `rotate(${minuteDegrees}deg)`;
            
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼å®Ÿè¡Œä¸­ã®å‡¦ç†
            if (state.menuRunning) {
                // ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹å§‹åœ°ç‚¹ã‹ã‚‰ã®çµŒéæ™‚é–“
                const menuElapsed = totalSeconds - state.menuStartElapsed;
                
                // ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
                state.events = state.events.filter(event => {
                    if (menuElapsed >= event.sec) {
                        console.log(`ğŸ”” ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«: ${event.sec}ç§’ (menuElapsed: ${menuElapsed.toFixed(1)}ç§’)`);
                        event.func();
                        return false;
                    }
                    return true;
                });
            }
            
            // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³æ›´æ–°
            if (state.menuRunning && state.cycleTime > 0) {
                // ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹å§‹åœ°ç‚¹ã‹ã‚‰ã®çµŒéæ™‚é–“
                const menuElapsed = totalSeconds - state.menuStartElapsed;
                const currentInCycle = menuElapsed % state.cycleTime;
                const nextStartIn = state.cycleTime - currentInCycle;
                elements.nextStart.textContent = Math.ceil(nextStartIn) + 'ç§’';
                elements.menuStart.textContent = '--';
            } else if (!state.menuWaiting) {
                // menuWaiting=true ã®é–“ã¯ startMenu å†…ã®ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ãŒå‹•ä½œä¸­ãªã®ã§ä¸Šæ›¸ãã—ãªã„
                elements.nextStart.textContent = '--';
                elements.menuStart.textContent = '--';
            }
            
            requestAnimationFrame(tick);
        }
        
        // ========================================
        // ç§’é‡ã‚¹ã‚¿ãƒ¼ãƒˆ
        // ========================================
        function syncClock() {
            console.log('ğŸ”µ ç§’é‡åŒæœŸ');
            
            // åˆå›ã®AudioContextåˆæœŸåŒ–
            if (!globalAudioContext) {
                try {
                    globalAudioContext = new (window.AudioContext || window.webkitAudioContext)();
                    console.log('âœ… ã‚°ãƒ­ãƒ¼ãƒãƒ«AudioContextåˆæœŸåŒ–æˆåŠŸ');
                    // ãƒ†ã‚¹ãƒˆéŸ³ã‚’é³´ã‚‰ã™ï¼ˆiOSã®ãƒ­ãƒƒã‚¯è§£é™¤ï¼‰
                    const testOscillator = globalAudioContext.createOscillator();
                    const testGain = globalAudioContext.createGain();
                    testGain.gain.value = 0;
                    testOscillator.connect(testGain);
                    testGain.connect(globalAudioContext.destination);
                    testOscillator.start();
                    testOscillator.stop(globalAudioContext.currentTime + 0.001);
                    console.log('âœ… AudioContextãƒ­ãƒƒã‚¯è§£é™¤æˆåŠŸ');
                } catch (e) {
                    console.log('âš ï¸ AudioContextåˆæœŸåŒ–å¤±æ•—:', e);
                }
            }
            
            if (!state.clockRunning && 'speechSynthesis' in window) {
                const dummyUtterance = new SpeechSynthesisUtterance('');
                dummyUtterance.volume = 0;
                speechSynthesis.speak(dummyUtterance);
            }
            
            // ç§’é‡ã‚’å†åŒæœŸï¼ˆã„ã¤ã§ã‚‚å®Ÿè¡Œå¯èƒ½ï¼‰
            state.clockRunning = true;
            state.clockStartMs = Date.now();
            state.minutePosition = parseInt(elements.minuteSlider.value);
            
            elements.syncBtn.textContent = 'ç§’é‡ã‚’åŒæœŸ';
            elements.syncBtn.className = 'btn btn-blue';
            elements.syncBtn.disabled = false;
            elements.startBtn.disabled = false;
            
            if (!state.tickRunning) {
                state.tickRunning = true;
                tick();
            }
            
            console.log('âœ… ç§’é‡åŒæœŸå®Œäº†');
        }
        
        // ========================================
        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹å§‹
        // ========================================
        function startMenu() {
            console.log('ğŸ”´ ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹å§‹');
            
            if (!state.clockRunning) {
                alert('å…ˆã«ç§’é‡ã‚¹ã‚¿ãƒ¼ãƒˆã‚’æŠ¼ã—ã¦ãã ã•ã„');
                return;
            }
            
            state.cycleTime = parseInt(elements.cycleMins.value) * 60 + parseInt(elements.cycleSecs.value);
            const swimmers = parseInt(elements.swimmers.value);
            const interval = parseInt(elements.interval.value);
            const sets = parseInt(elements.sets.value);
            
            if (state.cycleTime < swimmers * interval) {
                alert('ã‚µãƒ¼ã‚¯ãƒ«ã‚¿ã‚¤ãƒ ãŒçŸ­ã™ãã¾ã™');
                return;
            }
            
            const currentElapsed = (Date.now() - state.clockStartMs) / 1000;
            const currentSecond = currentElapsed % 60;
            const waitSeconds = currentSecond < 0.5 ? 0 : 60 - currentSecond;
            const nextZeroElapsed = Math.ceil(currentElapsed / 60) * 60;
            
            console.log('ğŸ“ å¾…æ©Ÿæ™‚é–“:', waitSeconds, 'ç§’');
            
            // 1æœ¬ç›®1çµ„ç›®ã®éŸ³å£°ãƒ»ãƒ“ãƒ¼ãƒ—ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
            if (waitSeconds >= 10) {
                const t10 = setTimeout(() => {
                    if (state.menuWaiting) {
                        elements.currentSet.textContent = '1';
                        if (elements.voice10sec.checked) {
                            speak('10ç§’å‰');
                        }
                    }
                }, (waitSeconds - 10) * 1000);
                state.timerIds.push(t10);
            }
            
            if (waitSeconds >= 5) {
                const t5 = setTimeout(() => {
                    if (state.menuWaiting) {
                        if (elements.voice5sec.checked) {
                            speak('5ç§’å‰');
                        }
                    }
                }, (waitSeconds - 5) * 1000);
                state.timerIds.push(t5);
            }
            
            // ãƒœã‚¿ãƒ³ã‚’å³åº§ã«ã€Œãƒ¡ãƒ‹ãƒ¥ãƒ¼åœæ­¢ã€ã«å¤‰æ›´
            elements.startBtn.textContent = 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼åœæ­¢';
            elements.startBtn.classList.remove('btn-red');
            elements.startBtn.classList.add('btn-gray');
            console.log('ğŸ”´ ãƒœã‚¿ãƒ³å¤‰æ›´: ãƒ¡ãƒ‹ãƒ¥ãƒ¼åœæ­¢ (ã‚°ãƒ¬ãƒ¼)', elements.startBtn.className);
            
            // è¨­å®šæ¬„ã‚’å³åº§ã«éè¡¨ç¤º
            elements.settings.classList.add('hidden');
            
            // 1æœ¬ç›®1çµ„ç›®ã®3ãƒ»2ãƒ»1ãƒ“ãƒ¼ãƒ—ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
            if (waitSeconds >= 3) {
                const t3 = setTimeout(() => {
                    if (state.menuWaiting) {
                        console.log('ğŸ”” ãƒ“ãƒ¼ãƒ—: 1æœ¬ç›®1çµ„ç›® 3ç§’å‰');
                        beepCountdown();
                    }
                }, (waitSeconds - 3) * 1000);
                state.timerIds.push(t3);
            }
            if (waitSeconds >= 2) {
                const t2 = setTimeout(() => {
                    if (state.menuWaiting) {
                        console.log('ğŸ”” ãƒ“ãƒ¼ãƒ—: 1æœ¬ç›®1çµ„ç›® 2ç§’å‰');
                        beepCountdown();
                    }
                }, (waitSeconds - 2) * 1000);
                state.timerIds.push(t2);
            }
            if (waitSeconds >= 1) {
                const t1 = setTimeout(() => {
                    if (state.menuWaiting) {
                        console.log('ğŸ”” ãƒ“ãƒ¼ãƒ—: 1æœ¬ç›®1çµ„ç›® 1ç§’å‰');
                        beepCountdown();
                    }
                }, (waitSeconds - 1) * 1000);
                state.timerIds.push(t1);
            }
            
            // 1æœ¬ç›®1çµ„ç›®ã®0ç§’ã‚¹ã‚¿ãƒ¼ãƒˆéŸ³ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
            const t0 = setTimeout(() => {
                if (state.menuWaiting) {
                    console.log('ğŸŸ¢ ã‚¹ã‚¿ãƒ¼ãƒˆ: 1æœ¬ç›®1çµ„ç›® (startMenuã‹ã‚‰)');
                    beepStart();
                }
            }, waitSeconds * 1000);
            state.timerIds.push(t0);
            
            // ã€Œãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹å§‹ã¾ã§ã€ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
            state.menuWaiting = true;
            const menuCountdownInterval = setInterval(() => {
                if (!state.menuWaiting) {
                    clearInterval(menuCountdownInterval);
                    return;
                }
                const elapsed = (Date.now() - state.clockStartMs) / 1000;
                const currentSec = elapsed % 60;
                const remaining = (currentSec < 0.5) ? 0 : 60 - currentSec;
                elements.menuStart.textContent = Math.ceil(remaining) + 'ç§’';
            }, 100);
            state.timerIds.push(menuCountdownInterval);
            
            const tFinal = setTimeout(() => {
                state.menuWaiting = false;
                clearInterval(menuCountdownInterval);
                
                // ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹å§‹ã¾ã§ã‚’ -- ã«è¨­å®š
                elements.menuStart.textContent = '--';
                
                state.menuStartElapsed = nextZeroElapsed;
                state.menuRunning = true;
            elements.syncBtn.disabled = true;  // ãƒ¡ãƒ‹ãƒ¥ãƒ¼å®Ÿè¡Œä¸­ã¯åŒæœŸã‚’ç¦æ­¢
                state.events = [];
                
                elements.syncBtn.disabled = true;
                elements.settings.classList.add('hidden');
                elements.totalSets.textContent = `/ ${sets}`;
                
                scheduleEvents(sets, swimmers, interval);
                
                console.log('âœ… ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹å§‹');
                
            }, waitSeconds * 1000);
            state.timerIds.push(tFinal);
        }
        
        // ========================================
        // ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°
        // ========================================
        function scheduleEvents(sets, swimmers, interval) {
            console.log('ğŸŸ¡ scheduleEventså‘¼ã³å‡ºã—:', sets, 'æœ¬', swimmers, 'çµ„', interval, 'ç§’é–“éš”');
            for (let set = 1; set <= sets; set++) {
                const isFirst = (set === 1);
                const isLast = (set === sets);
                // ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹å§‹åœ°ç‚¹ï¼ˆ0ç§’ï¼‰ã‹ã‚‰ã®ç›¸å¯¾æ™‚é–“
                const setStartSec = (set - 1) * state.cycleTime;
                
                // 2æœ¬ç›®ä»¥é™: æœ¬æ•°ã‚³ãƒ¼ãƒ«ï¼ˆ-12ç§’ï¼‰
                if (set > 1) {
                    state.events.push({
                        sec: setStartSec - 12,
                        func: () => {
                            if (elements.voiceSetNumber.checked) {
                                speak(isLast ? 'ãƒ©ã‚¹ãƒˆ' : `${set}æœ¬ç›®`);
                            }
                        }
                    });
                    
                    // 2æœ¬ç›®ä»¥é™: 10ç§’å‰ã‚³ãƒ¼ãƒ«
                    state.events.push({
                        sec: setStartSec - 10,
                        func: () => {
                            elements.currentSet.textContent = String(set);
                            if (elements.voice10sec.checked) {
                                speak('10ç§’å‰');
                            }
                        }
                    });
                    
                    // 2æœ¬ç›®ä»¥é™: 5ç§’å‰ã‚³ãƒ¼ãƒ«
                    state.events.push({
                        sec: setStartSec - 5,
                        func: () => {
                            if (elements.voice5sec.checked) {
                                speak('5ç§’å‰');
                            }
                        }
                    });
                }
                
                // å„çµ„ã®ã‚¹ã‚¿ãƒ¼ãƒˆï¼ˆ3ãƒ»2ãƒ»1ãƒ“ãƒ¼ãƒ— + ã‚¹ã‚¿ãƒ¼ãƒˆï¼‰
                for (let i = 1; i <= swimmers; i++) {
                    const swimmerStartSec = setStartSec + (i - 1) * interval;
                    
                    // 1æœ¬ç›®1çµ„ç›®ã¯ startMenu() ã§å‡¦ç†æ¸ˆã¿ã®ãŸã‚ã‚¹ã‚­ãƒƒãƒ—
                    if (set === 1 && i === 1) {
                        continue;
                    }
                    
                    // 3ãƒ»2ãƒ»1ãƒ“ãƒ¼ãƒ—ï¼ˆé«˜éŸ³ãƒ»çŸ­ã„äºˆå‘ŠéŸ³ï¼‰
                    for (let countdown = 3; countdown >= 1; countdown--) {
                        state.events.push({
                            sec: swimmerStartSec - countdown,
                            func: () => {
                                console.log(`ğŸ”” ãƒ“ãƒ¼ãƒ—: ${set}æœ¬ç›®${i}çµ„ç›® ${countdown}ç§’å‰`);
                                beepCountdown();
                            }
                        });
                    }
                    
                    // ã‚¹ã‚¿ãƒ¼ãƒˆãƒ“ãƒ¼ãƒ—ï¼ˆ0ç§’ç”¨ã®ç‰¹åˆ¥ãªéŸ³ï¼‰
                    state.events.push({
                        sec: swimmerStartSec,
                        func: () => {
                            console.log(`ğŸŸ¢ ã‚¹ã‚¿ãƒ¼ãƒˆ: ${set}æœ¬ç›®${i}çµ„ç›®`);
                            beepStart(); // ä½éŸ³ãƒ»é•·ã„ãƒ»å¤§ãã„ã‚¹ã‚¿ãƒ¼ãƒˆéŸ³
                            // éŸ³å£°ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã¯å‰Šé™¤ï¼ˆãƒ–ã‚¶ãƒ¼éŸ³ã¨è¢«ã‚‹ãŸã‚ï¼‰
                        }
                    });
                }
            }
            
            // å…¨æœ¬æ•°å®Œäº†
            const lastSetEnd = sets * state.cycleTime;
            state.events.push({
                sec: lastSetEnd,
                func: () => {
                    beepLarge(); // å¤§ãã‚ã®ãƒ“ãƒ¼ãƒ—éŸ³
                    setTimeout(stopMenu, 2000);
                }
            });
            
            state.events.sort((a, b) => a.sec - b.sec);
            console.log('ğŸ“ ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²å®Œäº†:', state.events.length, 'å€‹');
        }
        
        // ========================================
        // åœæ­¢
        // ========================================
        function stopMenu() {
            console.log('â›” stopMenu å‘¼ã³å‡ºã— - ã‚¿ã‚¤ãƒãƒ¼æ•°:', state.timerIds.length);
            
            // ã™ã¹ã¦ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
            state.timerIds.forEach((id, index) => {
                clearTimeout(id);
                clearInterval(id);
                console.log(`âœ… ã‚¿ã‚¤ãƒãƒ¼ ${index + 1} ã‚’ã‚¯ãƒªã‚¢`);
            });
            state.timerIds = [];
            console.log('âœ… ã™ã¹ã¦ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢å®Œäº†');
            
            state.menuRunning = false;
            elements.syncBtn.disabled = false;  // ãƒ¡ãƒ‹ãƒ¥ãƒ¼åœæ­¢ã§åŒæœŸã‚’å†è¨±å¯
            state.menuWaiting = false;
            state.events = [];
            
            elements.startBtn.textContent = 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹å§‹';
            elements.startBtn.classList.remove('btn-gray');
            elements.startBtn.classList.add('btn-red');
            console.log('ğŸ”´ ãƒœã‚¿ãƒ³å¤‰æ›´: ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹å§‹ (èµ¤)', elements.startBtn.className);
            elements.settings.classList.remove('hidden');
            elements.syncBtn.disabled = false;
            
            elements.currentSet.textContent = '-';
            elements.totalSets.textContent = '/ -';
            
            // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³æ ã‚’ãƒªã‚»ãƒƒãƒˆ
            elements.nextStart.textContent = '--';
            elements.menuStart.textContent = '--';
            
            console.log('â›” ãƒ¡ãƒ‹ãƒ¥ãƒ¼åœæ­¢');
        }
        
        // ========================================
        // éŸ³å£°åˆæˆ
        // ========================================
        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ja-JP';
                utterance.rate = 1.0;
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                speechSynthesis.speak(utterance);
                console.log('ğŸ”Š éŸ³å£°:', text);
            }
        }
        
        // ========================================
        // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ãƒ“ãƒ¼ãƒ—éŸ³ï¼ˆ3ãƒ»2ãƒ»1ç§’å‰ç”¨ï¼‰
        // ========================================
        function beepCountdown() {
            console.log("ğŸ”” beepCountdownå‘¼ã³å‡ºã—");
            if (globalAudioContext) {
                const audioContext = globalAudioContext;
                
                // ãƒ¡ã‚¤ãƒ³éŸ³ï¼ˆ400Hzã€ã‚ˆã‚Šä½ãå¤ªã„ï¼‰
                const osc1 = audioContext.createOscillator();
                const gain1 = audioContext.createGain();
                osc1.frequency.value = 400;
                osc1.type = 'square';
                osc1.connect(gain1);
                gain1.connect(audioContext.destination);
                gain1.gain.setValueAtTime(0.7, audioContext.currentTime);
                gain1.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.08);
                
                // å€éŸ³ï¼ˆ800Hzã€åšã¿ã‚’å‡ºã™ï¼‰
                const osc2 = audioContext.createOscillator();
                const gain2 = audioContext.createGain();
                osc2.frequency.value = 800;
                osc2.type = 'sawtooth';
                osc2.connect(gain2);
                gain2.connect(audioContext.destination);
                gain2.gain.setValueAtTime(0.3, audioContext.currentTime);
                gain2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.08);
                
                osc1.start(audioContext.currentTime);
                osc1.stop(audioContext.currentTime + 0.08);
                osc2.start(audioContext.currentTime);
                osc2.stop(audioContext.currentTime + 0.08);
                
                console.log('ğŸ”” ãƒ“ãƒ¼ãƒ—ï¼ˆ3ãƒ»2ãƒ»1ï¼‰- ãƒ€ãƒ–ãƒ«ã‚ªã‚·ãƒ¬ãƒ¼ã‚¿ãƒ¼: 400Hz+800Hz 0.08ç§’');
            }
        }
        
        // ========================================
        // ã‚¹ã‚¿ãƒ¼ãƒˆãƒ“ãƒ¼ãƒ—éŸ³ï¼ˆ0ç§’ç”¨ï¼‰
        // ========================================
        function beepStart() {
            if (globalAudioContext) {
                const audioContext = globalAudioContext;
                
                // ãƒ¡ã‚¤ãƒ³éŸ³ï¼ˆ400Hzã€ã‚ˆã‚Šä½ãå¤ªã„ï¼‰
                const osc1 = audioContext.createOscillator();
                const gain1 = audioContext.createGain();
                osc1.frequency.value = 400;
                osc1.type = 'square';
                osc1.connect(gain1);
                gain1.connect(audioContext.destination);
                gain1.gain.setValueAtTime(0.7, audioContext.currentTime);
                gain1.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.7);
                
                // å€éŸ³ï¼ˆ800Hzã€åšã¿ã‚’å‡ºã™ï¼‰
                const osc2 = audioContext.createOscillator();
                const gain2 = audioContext.createGain();
                osc2.frequency.value = 800;
                osc2.type = 'sawtooth';
                osc2.connect(gain2);
                gain2.connect(audioContext.destination);
                gain2.gain.setValueAtTime(0.3, audioContext.currentTime);
                gain2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.7);
                
                osc1.start(audioContext.currentTime);
                osc1.stop(audioContext.currentTime + 0.7);
                osc2.start(audioContext.currentTime);
                osc2.stop(audioContext.currentTime + 0.7);
                
                console.log('ğŸ”Š ã‚¹ã‚¿ãƒ¼ãƒˆãƒ“ãƒ¼ãƒ—ï¼ˆ0ç§’ï¼‰- ãƒ€ãƒ–ãƒ«ã‚ªã‚·ãƒ¬ãƒ¼ã‚¿ãƒ¼: 400Hz+800Hz 0.7ç§’');
            }
        }
        
        // ========================================
        // å¤§ãã‚ã®ãƒ“ãƒ¼ãƒ—éŸ³ï¼ˆå…¨æœ¬æ•°å®Œäº†ç”¨ï¼‰
        // ========================================
        function beepLarge() {
            if (globalAudioContext) {
                const audioContext = globalAudioContext;
                
                // ãƒ¡ã‚¤ãƒ³éŸ³ï¼ˆ350Hzã€ã‚ˆã‚Šä½ãå¤ªã„ï¼‰
                const osc1 = audioContext.createOscillator();
                const gain1 = audioContext.createGain();
                osc1.frequency.value = 350;
                osc1.type = 'square';
                osc1.connect(gain1);
                gain1.connect(audioContext.destination);
                gain1.gain.setValueAtTime(0.7, audioContext.currentTime);
                gain1.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1.2);
                
                // å€éŸ³ï¼ˆ700Hzã€åšã¿ã‚’å‡ºã™ï¼‰
                const osc2 = audioContext.createOscillator();
                const gain2 = audioContext.createGain();
                osc2.frequency.value = 700;
                osc2.type = 'sawtooth';
                osc2.connect(gain2);
                gain2.connect(audioContext.destination);
                gain2.gain.setValueAtTime(0.3, audioContext.currentTime);
                gain2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1.2);
                
                osc1.start(audioContext.currentTime);
                osc1.stop(audioContext.currentTime + 1.2);
                osc2.start(audioContext.currentTime);
                osc2.stop(audioContext.currentTime + 1.2);
                
                console.log('ğŸ”Š å¤§ãã‚ãƒ“ãƒ¼ãƒ—ï¼ˆå…¨æœ¬æ•°å®Œäº†ï¼‰- ãƒ€ãƒ–ãƒ«ã‚ªã‚·ãƒ¬ãƒ¼ã‚¿ãƒ¼: 350Hz+700Hz 1.2ç§’');
            }
        }
        
        // ========================================
        // ãƒ–ã‚¶ãƒ¼éŸ³ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ5ç¨®é¡ï¼‰
        // ========================================
        
        // ãƒ‘ã‚¿ãƒ¼ãƒ³A: é«˜éŸ³ãƒ»çŸ­ã„ï¼ˆé›»å­ãƒ–ã‚¶ãƒ¼é¢¨ï¼‰
        function testBeepA() {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain).connect(ctx.destination);
            osc.frequency.value = 2000; // é«˜éŸ³
            osc.type = 'square';
            gain.gain.setValueAtTime(1.0, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
            osc.start();
            osc.stop(ctx.currentTime + 0.1);
            console.log('ğŸ”Š ãƒ‘ã‚¿ãƒ¼ãƒ³A: 2000Hz square 0.1ç§’');
        }
        
        // ãƒ‘ã‚¿ãƒ¼ãƒ³B: ä¸­éŸ³ãƒ»çŸ­ã„ï¼ˆãƒ”ãƒ¼éŸ³ï¼‰
        function testBeepB() {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain).connect(ctx.destination);
            osc.frequency.value = 1000;
            osc.type = 'square';
            gain.gain.setValueAtTime(1.0, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.15);
            osc.start();
            osc.stop(ctx.currentTime + 0.15);
            console.log('ğŸ”Š ãƒ‘ã‚¿ãƒ¼ãƒ³B: 1000Hz square 0.15ç§’');
        }
        
        // ãƒ‘ã‚¿ãƒ¼ãƒ³C: ä½éŸ³ãƒ»é•·ã„ï¼ˆãƒ–ãƒ¼éŸ³ï¼‰
        function testBeepC() {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain).connect(ctx.destination);
            osc.frequency.value = 600;
            osc.type = 'square';
            gain.gain.setValueAtTime(1.0, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
            osc.start();
            osc.stop(ctx.currentTime + 0.3);
            console.log('ğŸ”Š ãƒ‘ã‚¿ãƒ¼ãƒ³C: 600Hz square 0.3ç§’');
        }
        
        // ãƒ‘ã‚¿ãƒ¼ãƒ³D: ã‚µã‚¤ãƒ¬ãƒ³é¢¨ï¼ˆå‘¨æ³¢æ•°å¤‰åŒ–ï¼‰
        function testBeepD() {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain).connect(ctx.destination);
            osc.frequency.setValueAtTime(800, ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, ctx.currentTime + 0.2);
            osc.type = 'square';
            gain.gain.setValueAtTime(1.0, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
            osc.start();
            osc.stop(ctx.currentTime + 0.2);
            console.log('ğŸ”Š ãƒ‘ã‚¿ãƒ¼ãƒ³D: 800-1200Hz square 0.2ç§’ ï¼ˆã‚µã‚¤ãƒ¬ãƒ³ï¼‰');
        }
        
        // ãƒ‘ã‚¿ãƒ¼ãƒ³E: 2éŸ³é€£ç¶šï¼ˆãƒ”ãƒƒãƒ”ãƒƒï¼‰
        function testBeepE() {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            
            // 1éŸ³ç›®
            const osc1 = ctx.createOscillator();
            const gain1 = ctx.createGain();
            osc1.connect(gain1).connect(ctx.destination);
            osc1.frequency.value = 1500;
            osc1.type = 'square';
            gain1.gain.setValueAtTime(1.0, ctx.currentTime);
            gain1.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.08);
            osc1.start(ctx.currentTime);
            osc1.stop(ctx.currentTime + 0.08);
            
            // 2éŸ³ç›®
            const osc2 = ctx.createOscillator();
            const gain2 = ctx.createGain();
            osc2.connect(gain2).connect(ctx.destination);
            osc2.frequency.value = 1500;
            osc2.type = 'square';
            gain2.gain.setValueAtTime(1.0, ctx.currentTime + 0.12);
            gain2.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
            osc2.start(ctx.currentTime + 0.12);
            osc2.stop(ctx.currentTime + 0.2);
            
            console.log('ğŸ”Š ãƒ‘ã‚¿ãƒ¼ãƒ³E: 1500Hz x2 square ï¼ˆãƒ”ãƒƒãƒ”ãƒƒï¼‰');
        }
        
        // ========================================
        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿
        // ========================================
        
        function saveMenu() {
            const menuName = prompt('ãƒ¡ãƒ‹ãƒ¥ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: 50mÃ—10æœ¬ã€100mÃ—5æœ¬ï¼‰');
            if (!menuName || menuName.trim() === '') {
                return;
            }
            
            const menuData = {
                name: menuName.trim(),
                cycleMins: parseInt(elements.cycleMins.value),
                cycleSecs: parseInt(elements.cycleSecs.value),
                swimmers: parseInt(elements.swimmers.value),
                interval: parseInt(elements.interval.value),
                sets: parseInt(elements.sets.value),
                voice10sec: elements.voice10sec.checked,
                voice5sec: elements.voice5sec.checked,
                voiceSetNumber: elements.voiceSetNumber.checked
            };
            
            let savedMenus = JSON.parse(localStorage.getItem('swimTimerMenus') || '[]');
            savedMenus.push(menuData);
            localStorage.setItem('swimTimerMenus', JSON.stringify(savedMenus));
            
            alert(`ã€Œ${menuName}ã€ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼`);
            loadSavedMenus();
        }
        
        function loadMenu(index) {
            const savedMenus = JSON.parse(localStorage.getItem('swimTimerMenus') || '[]');
            const menu = savedMenus[index];
            if (!menu) return;
            
            elements.cycleMins.value = menu.cycleMins;
            elements.cycleSecs.value = menu.cycleSecs;
            elements.swimmers.value = menu.swimmers;
            elements.interval.value = menu.interval;
            elements.sets.value = menu.sets;
            elements.voice10sec.checked = menu.voice10sec;
            elements.voice5sec.checked = menu.voice5sec;
            elements.voiceSetNumber.checked = menu.voiceSetNumber;
            
            updateDisplay();
            alert(`ã€Œ${menu.name}ã€ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼`);
        }
        
        function deleteMenu(index) {
            const savedMenus = JSON.parse(localStorage.getItem('swimTimerMenus') || '[]');
            const menu = savedMenus[index];
            if (!menu) return;
            
            if (confirm(`ã€Œ${menu.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                savedMenus.splice(index, 1);
                localStorage.setItem('swimTimerMenus', JSON.stringify(savedMenus));
                loadSavedMenus();
            }
        }
        
        function loadSavedMenus() {
            const savedMenus = JSON.parse(localStorage.getItem('swimTimerMenus') || '[]');
            const container = document.getElementById('savedMenusContainer');
            const list = document.getElementById('savedMenusList');
            
            if (savedMenus.length === 0) {
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'block';
            list.innerHTML = '';
            
            savedMenus.forEach((menu, index) => {
                const btn = document.createElement('button');
                btn.className = 'btn btn-blue';
                btn.style.cssText = 'padding: 8px 12px; font-size: 13px; position: relative;';
                btn.innerHTML = `
                    ${menu.name}
                    <span style="position: absolute; top: -5px; right: -5px; background: #d02626; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; cursor: pointer;" onclick="event.stopPropagation(); deleteMenu(${index})">Ã—</span>
                `;
                btn.onclick = () => loadMenu(index);
                list.appendChild(btn);
            });
        }
        
        // ========================================
        // èµ·å‹•
        // ========================================
        window.addEventListener('load', initialize);
    </script>
</body>
</html>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  